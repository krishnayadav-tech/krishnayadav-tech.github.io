<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investment Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }

    .card {
      border-radius: 12px;
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    #output .card {
      border-radius: 12px;
      transition: all 0.3s ease-in-out;
    }

    #output .card:hover {
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .input-group {
      width: 100px;
    }

    .form-range {
      flex: 1;
    }

    .input-group-text {
      min-width: 20px;
      justify-content: center;
    }
    
    .content-container {
      box-shadow: 0px 0px 30px 0px #1369EB1A !important;
      border: none !important;
    }

    .main-container {
      max-width: 1200px;
      padding: 20px !important;
      margin: 0 auto !important;
    }

    .justify-content-center {
      justify-content: center !important;
    }
  </style>
</head>

<body>
  <div class="container py-5 main-container">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-sm p-4 content-container">
          <h2 class="text-center mb-4">Investment Calculator</h2>

           <!-- Initial Amount -->
           <div class="mb-3">
            <label class="form-label">Initial Amount:</label>
            <input type="text" id="initialAmount" class="form-control" value="10,000">
          </div>

          <!-- Monthly Investment -->
          <div class="mb-3">
            <label class="form-label">Additional Monthly Investment:</label>
            <input type="text" id="amount" class="form-control" value="10,000">
          </div>

          <!-- Time (Years) -->
          <div class="mb-3">
            <label class="form-label">Time (Years):</label>
            <div class="slider-group">
              <input type="range" id="time" class="form-range" min="1" max="50" value="10">
              <div class="input-group">
                <input type="number" id="timeInput" class="form-control" min="1" max="50" value="10">
                <span class="input-group-text">Yrs</span>
              </div>
            </div>
          </div>

          <!-- Step-up Rate -->
          <div class="mb-3">
            <label class="form-label">Annual Step-up (%):</label>
            <div class="slider-group">
              <input type="range" id="stepUpRateRange" class="form-range" min="0" max="40" step="0.1" value="0">
              <div class="input-group">
                <input type="number" id="stepUpRate" class="form-control" min="0" max="40" step="0.1" value="0">
                <span class="input-group-text">%</span>
              </div>
            </div>
          </div>

          <!-- Expected Return Rate -->
          <div class="mb-3">
            <label class="form-label">Expected Return Rate (P.A):</label>
            <div class="slider-group">
              <input type="range" id="returnRate" class="form-range" min="1" max="40" step="0.1" value="12">
              <div class="input-group">
                <input type="number" id="returnRateInput" class="form-control" min="1" max="40" step="0.1" value="12">
                <span class="input-group-text">%</span>
              </div>
            </div>
          </div>

          <!-- Inflation Rate -->
          <div class="mb-3">
            <label class="form-label">Inflation Rate (P.A):</label>
            <div class="slider-group">
              <input type="range" id="inflationRateRange" class="form-range" min="0" max="15" step="0.1" value="6">
              <div class="input-group">
                <input type="number" id="inflationRate" class="form-control" min="0" max="15" step="0.1" value="6">
                <span class="input-group-text">%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="output mt-4 alert alert-success d-none" id="output"></div>
      </div>
    </div>
  </div>

  <script>
    const bindRangeSync = (rangeEl, inputEl, min, max) => {
      rangeEl.addEventListener('input', () => {
        console.log(rangeEl.value);
        inputEl.value = rangeEl.value;
      });

      inputEl.addEventListener('input', () => {
        const val = Math.min(Math.max(parseFloat(inputEl.value), min), max);
        if (val >= max) {
          inputEl.value = max;
        }
        if (val <= min) {
          inputEl.value = min;
        }
        rangeEl.value = val;
      });
    };

    const formatINR = val => {
      const num = parseFloat(val.replace(/,/g, ''));
      return isNaN(num) ? '' : Number(num).toLocaleString('en-IN');
    };

    const bindCommaFormatting = input => {
      input.addEventListener('input', e => {
        e.target.value = formatINR(e.target.value);
      });
    };

    const toINR = val => Number(Math.round(val)).toLocaleString('en-IN', {
      maximumFractionDigits: 0,
      minimumFractionDigits: 0,
    });

    function calculate() {
      const monthlyInvestment = parseFloat(amountInput.value.replace(/,/g, '')) || 0;
      const initialAmount = parseFloat(initialAmountInput.value.replace(/,/g, '') || 0);
      const stepUpRate = parseFloat(stepUpRateInput.value) / 100;
      const years = parseInt(time.value);
      const rate = parseFloat(returnRate.value) / 100;
      const inflation = parseFloat(inflationRateInput.value) / 100;
      const monthlyRate = rate / 12;

      let futureValue = 0;
      let accumulated = 0;
      let currentInvestment = monthlyInvestment;

      for (let year = 0; year < years; year++) {
        for (let month = 1; month <= 12; month++) {
          const n = (years - year) * 12 - (month - 1);
          futureValue += currentInvestment * Math.pow(1 + monthlyRate, n);
        }
        accumulated += currentInvestment * 12;
        currentInvestment *= (1 + stepUpRate);
      }

      if (initialAmount > 0) {
        futureValue += initialAmount * Math.pow(1 + rate, years);
        accumulated += initialAmount;
      }

      const inflationAdjusted = futureValue / Math.pow(1 + inflation, years);
      const returnStatus = rate >= inflation ? 'good' : 'bad';
      const output = document.getElementById('output');

      output.classList.remove('d-none');
      output.innerHTML = `
        <div class="card border-${returnStatus === 'good' ? 'success' : 'danger'} shadow">
          <div class="card-body">
            <h5 class="card-title mb-4 text-center d-flex align-items-center justify-content-center gap-2">
              <i class="bi bi-bar-chart-fill text-${returnStatus === 'good' ? 'success' : 'danger'}"></i>
              Investment Summary
            </h5>
            <div class="row text-center mb-4">
              <div class="col-md-4 mb-3 mb-md-0">
                <div class="p-3 rounded bg-light">
                  <div class="text-muted small mb-1">üìà Future Value</div>
                  <div class="fs-5 fw-bold text-primary">‚Çπ${toINR(futureValue)}</div>
                </div>
              </div>
              <div class="col-md-4 mb-3 mb-md-0">
                <div class="p-3 rounded bg-light">
                  <div class="text-muted small mb-1">üí∞ Total Investment</div>
                  <div class="fs-5 fw-bold text-dark">‚Çπ${toINR(accumulated)}</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="p-3 rounded bg-light">
                  <div class="text-muted small mb-1">üìâ Inflation Adjusted 
                    <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip"
                      title="What it looks like in today's world (Inflation adjusted)"></i>
                  </div>
                  <div class="fs-5 fw-bold text-warning">‚Çπ${toINR(inflationAdjusted)}</div>
                </div>
              </div>
            </div>
            <div class="mt-3 text-center">
              <div class="alert alert-${returnStatus === 'good' ? 'success' : 'danger'} d-inline-block" role="alert">
                ${returnStatus === 'good'
          ? 'üöÄ Awesome! Your returns are beating inflation.'
          : '‚ö†Ô∏è Heads up! Your returns are lower than inflation.'}
              </div>
            </div>
          </div>
        </div>
      `;

      bootstrap.Tooltip.getInstance(document.querySelector('[data-bs-toggle="tooltip"]'))?.dispose();
      new bootstrap.Tooltip(document.querySelector('[data-bs-toggle="tooltip"]'));
    }

    // Slider disable 
    const sliders = document.querySelectorAll('input[type="range"]');
    sliders.forEach(slider => {
      slider.addEventListener('mousedown', e => {
        const thumbWidth = 20; // Approximate thumb size
        const sliderRect = slider.getBoundingClientRect();
        const clickX = e.clientX - sliderRect.left;
        const percent = clickX / sliderRect.width;
        const value = slider.min * 1 + percent * (slider.max - slider.min);

        // Get current slider value position
        const currentPercent = (slider.value - slider.min) / (slider.max - slider.min);
        const currentX = currentPercent * sliderRect.width;

        // Only allow drag if user clicked near the thumb
        if (Math.abs(currentX - clickX) > thumbWidth / 2) {
          e.preventDefault(); // Block jump
        }
      });
    });
  
    // JS code to bind the range and input fields
    const time = document.getElementById('time');
    const timeInput = document.getElementById('timeInput');
    const returnRate = document.getElementById('returnRate');
    const returnRateInput = document.getElementById('returnRateInput');
    const inflationRateRange = document.getElementById('inflationRateRange');
    const inflationRateInput = document.getElementById('inflationRate');
    const stepUpRateRange = document.getElementById('stepUpRateRange');
    const stepUpRateInput = document.getElementById('stepUpRate');
    const amountInput = document.getElementById('amount');
    const initialAmountInput = document.getElementById('initialAmount');

    bindRangeSync(time, timeInput, 1, 50);
    bindRangeSync(returnRate, returnRateInput, 1, 40);
    bindRangeSync(inflationRateRange, inflationRateInput, 0, 15);
    bindRangeSync(stepUpRateRange, stepUpRateInput, 0, 40);
    bindCommaFormatting(amountInput);
    bindCommaFormatting(initialAmountInput);

    // JS code to calculate the investment summary
    [
      time,
      timeInput,
      returnRate,
      returnRateInput,
      inflationRateRange,
      inflationRateInput,
      stepUpRateRange,
      stepUpRateInput,
      amountInput,
      initialAmountInput
    ].forEach(el => {
      el.addEventListener('input', () => {
        calculate();
      });
    }); 

    calculate();
  </script>
</body>

</html>
